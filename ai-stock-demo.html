<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Stock Prediction Demo | Christopher Alemao</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

  <style>
    :root {
      --bg-from: 15, 23, 42;
      --bg-to: 2, 6, 23;
      --accent: 59, 130, 246;
      --accent-2: 56, 189, 248;
      --accent-3: 34, 197, 94;
    }

    body {
      font-family: "Inter", sans-serif;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.18), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(34, 197, 94, 0.16), transparent 55%),
                  linear-gradient(to bottom right,
                    rgb(var(--bg-from)),
                    rgb(var(--bg-to)));
      min-height: 100vh;
      color: #e5e7eb;
    }

    /* Animated grid background */
    .grid-bg {
      position: fixed;
      inset: 0;
      opacity: 0.3;
      background-image:
        linear-gradient(rgba(148, 163, 184, 0.12) 1px, transparent 1px),
        linear-gradient(90deg, rgba(148, 163, 184, 0.12) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
      z-index: -1;
      animation: grid-move 40s linear infinite;
    }

    @keyframes grid-move {
      0%   { transform: translate3d(0, 0, 0); }
      50%  { transform: translate3d(-40px, -40px, 0); }
      100% { transform: translate3d(0, 0, 0); }
    }

    /* Glass card + glow ring */
    .glass-card {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.10), transparent 55%),
                  rgba(15, 23, 42, 0.92);
      border: 1px solid rgba(148, 163, 184, 0.24);
      box-shadow:
        0 24px 80px rgba(15, 23, 42, 0.95),
        0 0 0 1px rgba(15, 23, 42, 1);
      backdrop-filter: blur(22px);
    }

    .glow-ring {
      position: absolute;
      inset: -2px;
      border-radius: 1.5rem;
      background: conic-gradient(
        from 180deg,
        rgba(var(--accent), 0.0),
        rgba(var(--accent), 0.85),
        rgba(var(--accent-2), 0.9),
        rgba(var(--accent-3), 0.95),
        rgba(var(--accent), 0.0)
      );
      opacity: 0.0;
      filter: blur(16px);
      transition: opacity 0.4s ease-out;
      pointer-events: none;
      z-index: -1;
    }

    .glass-card:hover .glow-ring {
      opacity: 0.9;
    }

    /* Result stat cards */
    .stat-card {
      background: radial-gradient(circle at top left, rgba(56,189,248,0.15), transparent 60%),
                  rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.4);
    }

    /* Backend status pill */
    .status-pill-ok {
      background: linear-gradient(to right, #22c55e, #4ade80);
      color: #052e16;
    }

    .status-pill-bad {
      background: linear-gradient(to right, #ef4444, #f97373);
      color: #450a0a;
    }

    /* Small pulse on the status dot */
    .status-dot {
      position: relative;
    }

    .status-dot::before {
      content: "";
      position: absolute;
      inset: -6px;
      border-radius: 999px;
      border: 1px solid currentColor;
      opacity: 0.45;
      animation: ping 1.4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes ping {
      0% {
        transform: scale(0.9);
        opacity: 0.7;
      }
      75%, 100% {
        transform: scale(1.35);
        opacity: 0;
      }
    }
  </style>
</head>

<body class="text-slate-100">
  <div class="grid-bg"></div>

  <div class="min-h-screen flex flex-col">
    <!-- Top bar -->
    <header class="w-full max-w-5xl mx-auto px-4 pt-6 flex items-center justify-between">
      <a href="index.htm#projects"
         class="inline-flex items-center gap-2 text-sm text-slate-300 hover:text-sky-300 transition-colors">
        <i class="fa-solid fa-arrow-left-long"></i>
        Back to Portfolio
      </a>

      <div id="backend-status"
           class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-medium bg-slate-800/80 border border-slate-600/60">
        <span class="status-dot inline-block h-2 w-2 rounded-full bg-yellow-400"></span>
        <span>Checking backend status…</span>
      </div>
    </header>

    <!-- Main content -->
    <main class="flex-1 flex items-center">
      <div class="w-full max-w-5xl mx-auto px-4 py-10">
        <div class="relative rounded-3xl glass-card p-8 md:p-10 overflow-hidden">
          <div class="glow-ring"></div>

          <div class="flex flex-col lg:flex-row gap-10 items-start">
            <!-- Left: description & input -->
            <section class="flex-1 space-y-6">
              <div>
                <p class="text-sm font-semibold uppercase tracking-[0.18em] text-sky-400/80 mb-2">
                  Live Experiment
                </p>
                <h1 class="text-3xl md:text-4xl font-bold tracking-tight mb-3">
                  AI Stock Prediction Demo
                </h1>
                <p class="text-slate-300 text-sm md:text-base leading-relaxed max-w-xl">
                  Enter a short history of closing prices and this demo will call a small prediction
                  service I built. It computes an average return, volatility, and a simple
                  next-day price estimate using a lightweight model behind the scenes.
                </p>
              </div>

              <div class="space-y-3">
                <label for="price-input" class="block text-sm font-medium text-slate-200">
                  Price history
                  <span class="ml-1 text-xs text-slate-400">(comma-separated, e.g. 100, 102, 101, 105, 110)</span>
                </label>
                <input
                  id="price-input"
                  type="text"
                  class="w-full rounded-xl border border-slate-600 bg-slate-900/70 px-4 py-3 text-sm md:text-base
                         text-slate-100 placeholder:text-slate-500 outline-none focus:ring-2 focus:ring-sky-500
                         focus:border-sky-400 transition"
                  placeholder="100, 102, 101, 105, 110"
                />

                <p id="form-error" class="text-sm text-rose-400 h-5"></p>

                <button
                  id="run-btn"
                  class="inline-flex items-center justify-center gap-2 rounded-xl bg-gradient-to-r
                         from-sky-500 via-indigo-500 to-emerald-400 px-5 py-2.5 text-sm md:text-base
                         font-semibold text-slate-900 shadow-lg shadow-sky-500/30
                         hover:from-sky-400 hover:via-indigo-400 hover:to-emerald-300
                         active:scale-[0.98] transition transform">
                  <i class="fa-solid fa-play"></i>
                  <span>Run Prediction</span>
                </button>

                <p class="text-[11px] md:text-xs text-slate-500 pt-1">
                  Note: For now this demo calls my backend directly.
                  Once deployed, it will run on a cloud API instead of <code>localhost</code>.
                </p>
              </div>
            </section>

            <!-- Right: results panel -->
            <section class="flex-1 space-y-4">
              <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div class="stat-card rounded-2xl p-4">
                  <p class="text-xs uppercase tracking-wide text-slate-400 mb-1">Average return</p>
                  <p id="avg-return" class="text-2xl font-semibold text-sky-300">—</p>
                  <p class="text-[11px] text-slate-500 mt-1">Mean % change per step.</p>
                </div>

                <div class="stat-card rounded-2xl p-4">
                  <p class="text-xs uppercase tracking-wide text-slate-400 mb-1">Volatility</p>
                  <p id="volatility" class="text-2xl font-semibold text-amber-300">—</p>
                  <p class="text-[11px] text-slate-500 mt-1">Standard deviation of returns.</p>
                </div>

                <div class="stat-card rounded-2xl p-4">
                  <p class="text-xs uppercase tracking-wide text-slate-400 mb-1">Next-day price</p>
                  <p id="next-price" class="text-2xl font-semibold text-emerald-300">—</p>
                  <p class="text-[11px] text-slate-500 mt-1">Simple model prediction.</p>
                </div>
              </div>

              <div class="rounded-2xl bg-slate-900/80 border border-slate-700 p-4 text-xs md:text-sm text-slate-300">
                <p class="font-semibold mb-1 text-slate-200">How it works (at a glance)</p>
                <ul class="list-disc list-inside space-y-1">
                  <li>Prices are converted into log returns.</li>
                  <li>The backend calculates mean return and volatility.</li>
                  <li>A naive one-step forecast estimates the next closing price.</li>
                </ul>
              </div>

              <p id="api-error" class="text-sm text-rose-400 h-5"></p>
            </section>
          </div>
        </div>

        <footer class="mt-6 text-[11px] md:text-xs text-slate-500 text-center">
          © 2025 Christopher Alemao — Demo only, not financial advice.
        </footer>
      </div>
    </main>
  </div>

  <script>
    // TODO: when you deploy your backend (Render / Railway / etc.), change this:
    // Example: const API_BASE = "https://your-backend-service.onrender.com";
    const API_BASE = "http://localhost:4000";

    const statusBox = document.getElementById("backend-status");
    const apiError = document.getElementById("api-error");
    const formError = document.getElementById("form-error");
    const runBtn = document.getElementById("run-btn");

    const avgEl = document.getElementById("avg-return");
    const volEl = document.getElementById("volatility");
    const nextEl = document.getElementById("next-price");

    // ---- Backend health check ----
    async function checkHealth() {
      try {
        const res = await fetch(API_BASE + "/api/health");
        if (!res.ok) throw new Error("Health check failed");
        const data = await res.json();

        statusBox.classList.add("status-pill-ok");
        statusBox.classList.remove("status-pill-bad");
        statusBox.innerHTML = `
          <span class="status-dot inline-block h-2 w-2 rounded-full bg-emerald-700"></span>
          <span class="hidden sm:inline">Backend Online</span>
          <span class="sm:ml-2 text-[10px] sm:text-xs text-emerald-900/75">
            ${data.time || ""}
          </span>
        `;
      } catch (err) {
        statusBox.classList.add("status-pill-bad");
        statusBox.classList.remove("status-pill-ok");
        statusBox.innerHTML = `
          <span class="status-dot inline-block h-2 w-2 rounded-full bg-rose-800"></span>
          <span>Backend Offline</span>
        `;
      }
    }

    // ---- Prediction handler ----
    async function runPrediction() {
      formError.textContent = "";
      apiError.textContent = "";

      const inputEl = document.getElementById("price-input");
      const raw = inputEl.value.trim();

      if (!raw) {
        formError.textContent = "Please enter at least a few prices.";
        return;
      }

      const parts = raw.split(",").map(p => p.trim()).filter(Boolean);
      const prices = parts.map(Number);

      if (prices.some(p => Number.isNaN(p) || p <= 0)) {
        formError.textContent = "All prices must be positive numbers (separated by commas).";
        return;
      }

      runBtn.disabled = true;
      runBtn.classList.add("opacity-70", "cursor-wait");
      runBtn.querySelector("span").textContent = "Running…";

      try {
        const res = await fetch(API_BASE + "/api/stock/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prices })
        });

        if (!res.ok) {
          throw new Error("API returned " + res.status);
        }

        const data = await res.json();

        const avg = data.avgReturn ?? data.averageReturn;
        const vol = data.volatility;
        const next = data.nextPrice ?? data.predictedPrice;

        avgEl.textContent = (avg * 100).toFixed(2) + "%";
        volEl.textContent = (vol * 100).toFixed(2) + "%";
        nextEl.textContent = next.toFixed(2);
      } catch (err) {
        console.error(err);
        apiError.textContent = "Could not contact prediction API. Make sure the backend is running (or deployed).";
      } finally {
        runBtn.disabled = false;
        runBtn.classList.remove("opacity-70", "cursor-wait");
        runBtn.querySelector("span").textContent = "Run Prediction";
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      checkHealth();
      runBtn.addEventListener("click", runPrediction);
    });
  </script>
</body>
</html>
